"use strict";function tP(a,b,c){fetch(a,{method:b,headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:c,mode:"no-cors"}).then(function(a){return console.log("EscalatingWebTrackSuccess",a),a}).catch(function(a){console.log("EscalatingWebTrackFailed",a)})}function tPG(a){fetch(a,{mode:"no-cors"}).then(function(a){return console.log("EscalatingWebTrackSuccess",a),a}).catch(function(a){console.log("EscalatingWebTrackFailed",a)})}var cacheNames={shell:"cachedShell.v2",js:"cachedJs.v1",css:"cachedCss.v2",img:"cachedImg.v2",font:"cachedFont.v2",api:"cachedApi.v2"},notification_url,notification_desc,notification_title;self.browser=function(){var b,a=navigator.userAgent,c=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(b=/\brv[ :]+(\d+)/g.exec(a)||[],"IE "+(b[1]||"")):"Chrome"===c[1]&&null!=(b=a.match(/\b(OPR|Edge)\/(\d+)/))?b.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(b=a.match(/version\/(\d+)/i))&&c.splice(1,1,b[1]),c.join(" "))}(),self.platform=navigator.platform,self.language=navigator.language,self.tUrl="https://track.escalatingweb.com/",self.addEventListener("install",function(a){self.skipWaiting()}),self.addEventListener("activate",function(a){return console.log("[EscalatingWeb] Activate"),a.waitUntil(caches.keys().then(function(a){return console.log(a),Promise.all(a.map(function(a){return caches.delete(a)}))})),self.clients.claim()}),self.addEventListener("fetch",function(a){var b=a.request.referrer,c=a.request.url;"GET"==a.request.method&&(-1==c.indexOf("localhost")&&-1==c.indexOf("https")||a.respondWith(caches.match(a.request).then(function(d){var e=a.request.clone(),f=cacheNames.shell;if(f=/.*\.(jpg|png|jpeg|gif)$/i.test(a.request.url)?cacheNames.img:/.*\.(css)/i.test(a.request.url)?cacheNames.css:/.*\.(js|json)/i.test(a.request.url)?cacheNames.js:/.*\.(woff|woff2)$/i.test(a.request.url)?cacheNames.font:cacheNames.api,d&&f!=cacheNames.api&&-1==b.indexOf("bp")&&-1==c.indexOf("bp"))return d;var g=fetch(e).then(function(b){if(!b||200!==b.status||"basic"!==b.type)return b;var c=b.clone();return caches.open(f).then(function(b){b.put(a.request,c)}),b});return b.indexOf("bp")>-1||c.indexOf("bp")>-1?g:d||g})))}),self.addEventListener("push",function(a){tPG(self.tUrl+"track/set_record/receive"+self.self.location.search+"&browser="+self.browser+"&platform="+self.platform+"&language="+self.language),console.log("EscalatingWebSW received a push message",a.data.text());var b=JSON.parse(a.data.text());notification_desc=b.desc,notification_url=b.url,notification_title=b.title;var c=notification_title,d={body:notification_desc,icon:"assets/images/96.png",badge:"assets/images/96.png"};a.waitUntil(self.registration.showNotification(c,d))}),self.addEventListener("notificationclick",function(a){tPG(self.tUrl+"track/set_record/click"+self.self.location.search+"&browser="+self.browser+"&platform="+self.platform+"&language="+self.language),a.notification.close();var b=notification_url;a.waitUntil(clients.matchAll({type:"window"}).then(function(a){for(var c=0;c<a.length;c++){var d=a[c];if(d.url===b&&"focus"in d)return d.focus()}if(clients.openWindow)return clients.openWindow(b)}))}),self.addEventListener("notificationclose",function(a){tPG(self.tUrl+"track/set_record/close"+self.self.location.search+"&browser="+self.browser+"&platform="+self.platform+"&language="+self.language),console.log("EscalatingWebClosed")}),self.addEventListener("message",function(a){if(a.data.endpoint){if(a.data.endpoint){var b=a.data,c="endpoint="+b.endpoint+"&p256dh="+b.p256dh+"&auth="+b.auth+"&"+self.self.location.search.substring(1)+"&browser="+self.browser+"&platform="+self.platform+"&language="+self.language;tP(self.tUrl+"track/subscribe","post",c)}}else self.cid=a.data.cid,self.did=a.data.did,self.u=a.data.u});